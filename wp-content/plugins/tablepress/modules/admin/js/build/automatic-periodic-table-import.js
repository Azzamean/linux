(()=>{"use strict";const e=window.React,t=window.ReactDOM,a=window.wp.i18n,l=window.wp.components,n=window.wp.primitives,r=(0,e.createElement)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(n.Path,{d:"M12 3.2c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8 0-4.8-4-8.8-8.8-8.8zm0 16c-4 0-7.2-3.3-7.2-7.2C4.8 8 8 4.8 12 4.8s7.2 3.3 7.2 7.2c0 4-3.2 7.2-7.2 7.2zM11 17h2v-6h-2v6zm0-8h2V7h-2v2z"})),s={60:(0,a.__)("Once per minute","tablepress"),900:(0,a.__)("Once per 15 minutes","tablepress"),3600:(0,a.__)("Once per hour","tablepress"),43200:(0,a.__)("Twice per day","tablepress"),86400:(0,a.__)("Once per day","tablepress"),604800:(0,a.__)("Once per week","tablepress")},c=Object.entries(s).map((([t,a])=>(0,e.createElement)("option",{key:t,value:t},a)));c.push((0,e.createElement)("option",{key:"custom",value:"custom"},(0,a.__)("Custom","tablepress")));const o=({disabled:t=!1,value:n,onChange:o})=>{const[i,m]=(0,e.useState)(!1),d=!s.hasOwnProperty(n);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("select",{disabled:t,value:i||d?"custom":n,onChange:e=>{"custom"===e.target.value?m(!0):(m(!1),o(e.target.value))}},c),(i||d)&&(0,e.createElement)(e.Fragment,null," ",(0,e.createElement)("input",{type:"text",className:"code",style:{width:"120px",padding:"0 6px"},disabled:t,value:n,onChange:e=>{o(/^\d+$/.test(e.target.value)?parseInt(e.target.value,10):e.target.value)}})," ",t?(0,e.createElement)(l.Icon,{icon:r,style:{fill:"rgba(44, 51, 56, 0.5)",verticalAlign:"middle"}}):(0,e.createElement)(l.Tooltip,{text:(0,a.__)("Interval in seconds or Cron-like schedule","tablepress")},(0,e.createElement)("span",null,(0,e.createElement)(l.Icon,{icon:r,style:{verticalAlign:"middle"}})))))},i=e=>"#"===e[0]?document.getElementById(e.slice(1)):document.querySelectorAll(e),m=window.wp.url,d=function(e,t){const a=`save-changes-${Date.now()}`,l=i("#spinner-save-changes");l.parentNode.insertAdjacentHTML("afterend",`<div id="${a}" class="ajax-alert notice notice-${e}"><p>${t}</p></div>`),l.remove();const n=i(`#${a}`);n.offsetWidth,n.style.opacity=0,n.addEventListener("transitionend",(()=>n.remove())),i(".button-save-changes").forEach((e=>e.disabled=!1)),document.body.classList.remove("wait")},p=(e,t)=>{const l=Object.fromEntries(Object.entries(t.tables).filter((([,e])=>e.active||"https://"!==e.location||86400!==e.interval)).map((([e,t])=>(delete t.selected,delete t.last_import,[e,t]))));var n;n={action:"tablepress_import",_ajax_nonce:i("#_wpnonce").value,tablepress:JSON.stringify(l)},e.insertAdjacentHTML("beforeend",`<span id="spinner-save-changes" class="spinner-save-changes spinner is-active" title="${(0,a.__)("Changes are being saved …","tablepress")}"/>`),i(".button-save-changes").forEach((e=>e.disabled=!0)),document.body.classList.add("wait"),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:(0,m.buildQueryString)(n)}).then((e=>{if(!e.ok)throw new Error(`There was a problem with the server, HTTP response code ${e.status} (${e.statusText}).`);return e.json()})).then((e=>{if(null==e||"-1"===e||void 0===e.success)throw new Error("The JSON data returned from the server is unclear or incomplete.");if(!0!==e.success){const t=e.error_details?`</p><p>These errors were encountered:</p><pre>${e.error_details}</pre><p>`:"";throw new Error(`The data could not be saved to the database properly.${t}`)}!function(e){const t={success_save:(0,a.__)("The changes were saved successfully.","tablepress"),error_save:(0,a.__)("Attention: Unfortunately, an error occurred.","tablepress")},l=e.message.includes("error")?"error":"success";d(l,t[e.message])}(e)})).catch((e=>{return t=e.message,t=(0,a.__)("Attention: Unfortunately, an error occurred.","tablepress")+" "+t,void d("error",t);var t}))};tp.automatic_periodic_table_import.tables=Object.fromEntries(Object.keys(tp.import.tables).map((e=>[e,{selected:!1,active:!1,location:"https://",interval:86400,last_import:"-",...tp.automatic_periodic_table_import.tables[e]}])));((e,a)=>{const l=document.getElementById("tablepress-automatic-periodic-table-import-screen");l&&("function"==typeof t.createRoot?(0,t.createRoot)(l).render(a):(0,t.render)(a,l))})(0,(0,e.createElement)((()=>{const[t,n]=(0,e.useState)((()=>({tables:tp.automatic_periodic_table_import.tables,shownTableIds:Object.keys(tp.automatic_periodic_table_import.tables),lastCheckboxTableId:null,searchTerm:"",sort:{column:"",direction:1},bulkAction:"",bulkActionInterval:86400}))),r=e=>{const a={...t,...e};n(a)},s=(e,a)=>{let l=Object.entries(t.tables);return""!==e&&(e=e.toLowerCase(),l=l.filter((([t,a])=>t.toLowerCase().includes(e)||tp.import.tables[t].toLowerCase().includes(e)||a.location.toLowerCase().includes(e)))),""!==a.column&&l.sort((([e,t],[l,n])=>{let r,s;return"id"===a.column?(r=e,s=l):"name"===a.column?(r=tp.import.tables[e],s=tp.import.tables[l]):(r=t[a.column].toString(),s=n[a.column].toString()),a.direction*((e,t)=>{const a=/(^([+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|^0x[\da-fA-F]+$|\d+)/g,l=/^\s+|\s+$/g,n=/\s+/g,r=/^0x[0-9a-f]+$/i,s=/^0/,c=e.replace(l,"")||"",o=t.replace(l,"")||"",i=c.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=o.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),d=parseInt(c.match(r),16)||1!==i.length&&Date.parse(c),p=parseInt(o.match(r),16)||d&&o.match(/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/)&&Date.parse(o)||null,u=(e,t)=>(!e.match(s)||1===t)&&parseFloat(e)||e.replace(n," ").replace(l,"")||0;if(p){if(d<p)return-1;if(d>p)return 1}for(let e=0,t=i.length,a=m.length,l=Math.max(t,a);e<l;e++){const l=u(i[e]||"",t),n=u(m[e]||"",a);if(isNaN(l)!==isNaN(n))return isNaN(l)?1:-1;if(/[^\x00-\x80]/.test(l+n)&&l.localeCompare){const e=l.localeCompare(n);return e/Math.abs(e)}if(l<n)return-1;if(l>n)return 1}return 0})(r,s)})),l.map((([e])=>e))},c=(0,e.createElement)("p",{className:"submit"},(0,e.createElement)("input",{type:"button",className:"button button-secondary button-large button-save-changes",value:(0,a.__)("Save Automatic Import configuration","tablepress"),onClick:e=>p(e.target.parentNode,t)})),i=({column:a,text:l})=>(0,e.createElement)("th",{className:a===t.sort.column?"sorted "+(1===t.sort.direction?"asc":"desc"):"sortable desc"},(0,e.createElement)("a",{href:"",role:"button",onClick:e=>{e.preventDefault();const l={column:a,direction:e.target.closest("th").classList.contains("asc")?-1:1},n=s(t.searchTerm,l);r({shownTableIds:n,sort:l})}},(0,e.createElement)("span",null,l),(0,e.createElement)("span",{className:"sorting-indicators"},(0,e.createElement)("span",{className:"sorting-indicator asc","aria-hidden":"true"}),(0,e.createElement)("span",{className:"sorting-indicator desc","aria-hidden":"true"}))));return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a.__)("To periodically import tables from files that were uploaded to a server, configure the desired interval and table source information below.","tablepress")),(0,e.createElement)("p",{className:"description"},(0,a.__)("Please note: In general, it is recommended to use a reasonably long interval, to reduce traffic on the import source server.","tablepress")+" "+(0,a.__)("In addition, it is recommended to set up a suitable server cron job that replaces the WP Cron system, for improved reliability.","tablepress")),c,(0,e.createElement)("div",{className:"tablenav top"},(0,e.createElement)("div",{className:"alignleft actions bulkactions"},(0,e.createElement)("label",{htmlFor:"bulk-action-selector-top",className:"screen-reader-text"},(0,a.__)("Select Bulk Action","tablepress")),(0,e.createElement)("select",{id:"bulk-action-selector-top",value:t.bulkAction,onChange:e=>{r({bulkAction:e.target.value})}},(0,e.createElement)("option",{value:""},(0,a.__)("Bulk Actions","tablepress")),(0,e.createElement)("option",{value:"activate"},(0,a.__)("Activate import","tablepress")),(0,e.createElement)("option",{value:"deactivate"},(0,a.__)("Deactivate import","tablepress")),(0,e.createElement)("option",{value:"set-interval"},(0,a.__)("Set import interval","tablepress"))),"set-interval"===t.bulkAction&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o,{value:t.bulkActionInterval,onChange:e=>{r({bulkActionInterval:e})}})," "),(0,e.createElement)("input",{type:"button",className:"button action",disabled:""===t.bulkAction||0===t.shownTableIds.length||!t.shownTableIds.some((e=>t.tables[e].selected)),value:(0,a.__)("Apply","tablepress"),onClick:()=>{const e=t.shownTableIds.filter((e=>t.tables[e].selected)),a={...t.tables};"activate"===t.bulkAction?e.forEach((e=>{a[e].active=!0})):"deactivate"===t.bulkAction?e.forEach((e=>{a[e].active=!1})):"set-interval"===t.bulkAction&&e.forEach((e=>{a[e].interval=t.bulkActionInterval})),r({tables:a,bulkAction:"",bulkActionInterval:86400})}})),(0,e.createElement)("p",{className:"search-box",style:{paddingBottom:"0.5em"}},(0,e.createElement)("label",{htmlFor:"tables_search-search-input"},(0,a.__)("Filter list:","tablepress")),(0,e.createElement)("input",{id:"tables_search-search-input",type:"search",value:t.searchTerm,onChange:e=>{const a=e.target.value,l=s(a,t.sort);r({shownTableIds:l,searchTerm:a})},style:{marginLeft:"0.5em"}})),(0,e.createElement)("br",{className:"clear"})),(0,e.createElement)("table",{id:"tablepress-automatic-periodic-import-tables",className:"widefat striped"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,e.createElement)("input",{type:"checkbox",id:"auto-import-select-all-thead",checked:0<t.shownTableIds.length&&t.shownTableIds.every((e=>t.tables[e].selected)),disabled:0===t.shownTableIds.length,onChange:e=>{const a={...t.tables};t.shownTableIds.forEach((t=>{a[t].selected=e.target.checked})),r({tables:a})},style:{margin:"0",verticalAlign:"middle"}}),(0,e.createElement)("label",{htmlFor:"auto-import-select-all-thead"},(0,e.createElement)("span",{className:"screen-reader-text"},(0,a.__)("Select All")))),(0,e.createElement)(i,{column:"id",text:(0,a.__)("ID","tablepress")}),(0,e.createElement)(i,{column:"name",text:(0,a.__)("Table Name","tablepress")}),(0,e.createElement)(i,{column:"active",text:(0,a.__)("Active","tablepress")}),(0,e.createElement)(i,{column:"location",text:(0,a.__)("Import File Location","tablepress")}),(0,e.createElement)(i,{column:"interval",text:(0,a.__)("Import Interval","tablepress")}),(0,e.createElement)(i,{column:"last_import",text:(0,a.__)("Last Automatic Import","tablepress")}))),(0,e.createElement)("tbody",null,0===t.shownTableIds.length?(0,e.createElement)("tr",null,(0,e.createElement)("td",{colSpan:"7"},(0,a.__)("No tables found.","tablepress"))):t.shownTableIds.map((n=>{const s=t.tables[n],c=""===tp.import.tables[n].trim()?(0,a.__)("(no name)","tablepress"):tp.import.tables[n];return(0,e.createElement)("tr",{key:n},(0,e.createElement)("th",{scope:"row"},(0,e.createElement)("input",{type:"checkbox",checked:s.selected,id:`cb-select-${n}`,onChange:e=>{const a=t.shownTableIds.indexOf(n);let l=t.shownTableIds.indexOf(t.lastCheckboxTableId);null!==t.lastCheckboxTableId&&e.nativeEvent.shiftKey||(l=a);const s=l<a?l:a,c=a>l?a:l,o={...t.tables};for(let a=s;a<=c;a++)o[t.shownTableIds[a]].selected=e.target.checked;r({tables:o,lastCheckboxTableId:n})},style:{margin:"0",verticalAlign:"middle"}}),(0,e.createElement)("label",{htmlFor:`cb-select-${n}`},(0,e.createElement)("span",{className:"screen-reader-text"},(0,a.sprintf)((0,a.__)("Select table “%s”","tablepress"),c)))),(0,e.createElement)("td",{style:{minWidth:"50px"}},n),(0,e.createElement)("td",{style:{minWidth:"120px"}},(0,e.createElement)("strong",null,c)),(0,e.createElement)("td",{style:{minWidth:"55px"}},(0,e.createElement)(l.ToggleControl,{checked:s.active,onChange:e=>{const a={...t.tables};a[n].active=e,r({tables:a})}})),(0,e.createElement)("td",{style:{minWidth:"300px"}},(0,e.createElement)("input",{type:"text",className:"large-text code",disabled:!s.active,value:s.location,onChange:e=>{const a={...t.tables};a[n].location=e.target.value,r({tables:a})}})),(0,e.createElement)("td",{style:{maxWidth:"260px"}},(0,e.createElement)(o,{disabled:!s.active,value:s.interval,onChange:e=>{const a={...t.tables};a[n].interval=e,r({tables:a})}})),(0,e.createElement)("td",{style:{minWidth:"160px",maxWidth:"190px"},dangerouslySetInnerHTML:{__html:s.last_import}}))}))),(0,e.createElement)("tfoot",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,e.createElement)("input",{type:"checkbox",id:"auto-import-select-all-tfoot",checked:0<t.shownTableIds.length&&t.shownTableIds.every((e=>t.tables[e].selected)),disabled:0===t.shownTableIds.length,onChange:e=>{const a={...t.tables};t.shownTableIds.forEach((t=>{a[t].selected=e.target.checked})),r({tables:a})},style:{margin:"0",verticalAlign:"middle"}}),(0,e.createElement)("label",{htmlFor:"auto-import-select-all-tfoot"},(0,e.createElement)("span",{className:"screen-reader-text"},(0,a.__)("Select All")))),(0,e.createElement)("th",null,(0,a.__)("ID","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Table Name","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Active","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Import File Location","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Import Interval","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Last Automatic Import","tablepress"))))),c)}),null))})();