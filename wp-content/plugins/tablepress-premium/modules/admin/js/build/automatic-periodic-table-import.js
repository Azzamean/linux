!function(){"use strict";var e=window.React,t=window.ReactDOM,a=window.wp.i18n;const r=e=>"#"===e[0]?document.getElementById(e.slice(1)):document.querySelectorAll(e);var l=window.wp.url;const s=function(e,t){const a=`save-changes-${Date.now()}`,l=r("#spinner-save-changes");l.parentNode.insertAdjacentHTML("afterend",`<div id="${a}" class="ajax-alert notice notice-${e}"><p>${t}</p></div>`),l.remove();const s=r(`#${a}`);s.offsetWidth,s.style.opacity=0,s.addEventListener("transitionend",(()=>s.remove())),r(".button-save-changes").forEach((e=>e.disabled=!1)),document.body.classList.remove("wait")};const n=(e,t)=>{const n=Object.fromEntries(Object.entries(t.tables).filter((([,e])=>e.active||"url"!==e.source||"https://"!==e.location)).map((([e,t])=>(delete t.last_import,[e,t])))),c={schedule:t.schedule,tables:n};var o;o={action:"tablepress_import",_ajax_nonce:r("#_wpnonce").value,tablepress:JSON.stringify(c)},e.insertAdjacentHTML("beforeend",`<span id="spinner-save-changes" class="spinner-save-changes spinner is-active" title="${(0,a.__)("Changes are being saved â€¦","tablepress")}"/>`),r(".button-save-changes").forEach((e=>e.disabled=!0)),document.body.classList.add("wait"),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:(0,l.buildQueryString)(o)}).then((e=>{if(!e.ok)throw new Error(`There was a problem with the server, HTTP response code ${e.status} (${e.statusText}).`);return e.json()})).then((e=>{if(null==e||"-1"===e||void 0===e.success)throw new Error("The JSON data returned from the server is unclear or incomplete.");if(!0!==e.success){const t=e.error_details?`</p><p>These errors were encountered:</p><pre>${e.error_details}</pre><p>`:"";throw new Error(`The data could not be saved to the database properly.${t}`)}!function(e){const t={success_save:(0,a.__)("The changes were saved successfully.","tablepress"),error_save:(0,a.__)("Attention: Unfortunately, an error occurred.","tablepress")},r=e.message.includes("error")?"error":"success";s(r,t[e.message])}(e)})).catch((e=>{return t=e.message,t=(0,a.__)("Attention: Unfortunately, an error occurred.","tablepress")+" "+t,void s("error",t);var t}))};tp.automatic_periodic_table_import.tables=Object.fromEntries(Object.keys(tp.import.tables).map((e=>[e,{active:!1,source:"url",location:"https://",last_import:"-",...tp.automatic_periodic_table_import.tables[e]}])));((e,a)=>{const r=document.getElementById("tablepress-automatic-periodic-table-import-screen");r&&("function"==typeof t.createRoot?(0,t.createRoot)(r).render(a):(0,t.render)(a,r))})(0,(0,e.createElement)((()=>{const[t,r]=(0,e.useState)({schedule:tp.automatic_periodic_table_import.schedule,tables:tp.automatic_periodic_table_import.tables,lastCheckboxTableId:null,searchTerm:"",sort:{column:-1,direction:1}});let l=Object.entries(t.tables);""!==t.searchTerm&&(l=l.filter((([e])=>tp.import.tables[e].toLowerCase().includes(t.searchTerm.toLowerCase())))),-1!==t.sort.column&&l.sort((([e],[a])=>{let r=e,l=a;return 1===t.sort.column&&(r=tp.import.tables[e],l=tp.import.tables[a]),t.sort.direction*((e,t)=>{const a=/(^([+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|^0x[\da-fA-F]+$|\d+)/g,r=/^\s+|\s+$/g,l=/\s+/g,s=/^0x[0-9a-f]+$/i,n=/^0/,c=e.replace(r,"")||"",o=t.replace(r,"")||"",i=c.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=o.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=parseInt(c.match(s),16)||1!==i.length&&Date.parse(c),d=parseInt(o.match(s),16)||p&&o.match(/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/)&&Date.parse(o)||null,u=(e,t)=>(!e.match(n)||1===t)&&parseFloat(e)||e.replace(l," ").replace(r,"")||0;if(d){if(p<d)return-1;if(p>d)return 1}for(let e=0,t=i.length,a=m.length,r=Math.max(t,a);e<r;e++){const r=u(i[e]||"",t),l=u(m[e]||"",a);if(isNaN(r)!==isNaN(l))return isNaN(r)?1:-1;if(/[^\x00-\x80]/.test(r+l)&&r.localeCompare){const e=r.localeCompare(l);return e/Math.abs(e)}if(r<l)return-1;if(r>l)return 1}return 0})(r,l)}));const s=(e,a)=>{const l={...t,[e]:a};r(l)},c=(0,e.createElement)("p",{className:"submit"},(0,e.createElement)("input",{type:"button",className:"button button-secondary button-large button-save-changes",value:(0,a.__)("Save Automatic Import configuration","tablepress"),onClick:e=>n(e.target.parentNode,t)}));return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a.__)("To periodically import tables from files that were uploaded to a server, configure the desired interval and table source information below.","tablepress")),(0,e.createElement)("p",null,(0,e.createElement)("label",{htmlFor:"auto-import-schedule"},(0,a.__)("Perform Automatic Periodic Table Import:","tablepress")+" "),(0,e.createElement)("select",{id:"auto-import-schedule",value:t.schedule,onChange:e=>s("schedule",e.target.value)},Object.entries(tp.automatic_periodic_table_import.cronSchedules).map((([t,a])=>(0,e.createElement)("option",{key:t,value:t},a.display))))),(0,e.createElement)("p",{className:"description"},(0,a.__)("Please note: In general, it is recommended to use a reasonably long interval, to reduce traffic on the import source server.","tablepress")+" "+(0,a.__)("In addition, it is recommended to set up a suitable server cron job that replaces the WP Cron system, for improved reliability.","tablepress")),c,(0,e.createElement)("p",{className:"search-box",style:{paddingBottom:"0.5em"}},(0,e.createElement)("label",{htmlFor:"tables_search-search-input"},(0,a.__)("Filter list:","tablepress")),(0,e.createElement)("input",{id:"tables_search-search-input",type:"search",value:t.searchTerm,onChange:e=>s("searchTerm",e.target.value),style:{marginLeft:"0.5em"}})),(0,e.createElement)("table",{id:"tablepress-automatic-periodic-import-tables",className:"widefat striped"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",{className:0===t.sort.column?"sorted "+(1===t.sort.direction?"desc":"asc"):"sortable desc",style:{minWidth:"50px"}},(0,e.createElement)("a",{href:"",role:"button",onClick:e=>{e.preventDefault(),s("sort",{column:0,direction:e.target.closest("th").classList.contains("desc")?-1:1})}},(0,e.createElement)("span",null,(0,a.__)("ID","tablepress")),(0,e.createElement)("span",{className:"sorting-indicators"},(0,e.createElement)("span",{className:"sorting-indicator asc","aria-hidden":"true"}),(0,e.createElement)("span",{className:"sorting-indicator desc","aria-hidden":"true"})))),(0,e.createElement)("th",{className:1===t.sort.column?"sorted "+(1===t.sort.direction?"desc":"asc"):"sortable desc",style:{minWidth:"120px"}},(0,e.createElement)("a",{href:"",role:"button",onClick:e=>{e.preventDefault(),s("sort",{column:1,direction:e.target.closest("th").classList.contains("desc")?-1:1})}},(0,e.createElement)("span",null,(0,a.__)("Table Name","tablepress")),(0,e.createElement)("span",{className:"sorting-indicators"},(0,e.createElement)("span",{className:"sorting-indicator asc","aria-hidden":"true"}),(0,e.createElement)("span",{className:"sorting-indicator desc","aria-hidden":"true"})))),(0,e.createElement)("th",null,(0,a.__)("Periodic Import","tablepress"),(0,e.createElement)("br",null),(0,e.createElement)("label",{htmlFor:"auto-import-select-all-thead"},(0,e.createElement)("input",{type:"checkbox",id:"auto-import-select-all-thead",checked:0<l.length&&l.every((([,e])=>e.active)),disabled:0===l.length,onChange:e=>{const a=Object.fromEntries(l.map((([t,a])=>[t,{...a,active:e.target.checked}]))),r={...t.tables,...a};s("tables",r)}})," ",(0,a.__)("Select All"))),(0,e.createElement)("th",null,(0,a.__)("Import Source","tablepress")),(0,e.createElement)("th",{className:"auto-import-location"},(0,a.__)("Import File Location","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Last Automatic Import","tablepress")))),(0,e.createElement)("tbody",null,0===l.length?(0,e.createElement)("tr",null,(0,e.createElement)("td",{colSpan:"6"},(0,a.__)("No tables found.","tablepress"))):l.map((([r,n])=>(0,e.createElement)("tr",{key:r},(0,e.createElement)("td",null,r),(0,e.createElement)("td",null,(0,e.createElement)("strong",null,""===tp.import.tables[r].trim()?(0,a.__)("(no name)","tablepress"):tp.import.tables[r])),(0,e.createElement)("td",null,(0,e.createElement)("input",{type:"checkbox",checked:n.active,onChange:e=>{const a=l.map((([e])=>e)),n=a.indexOf(r);let c=a.indexOf(t.lastCheckboxTableId);null!==t.lastCheckboxTableId&&e.nativeEvent.shiftKey||(c=n);const o=c<n?c:n,i=n>c?n:c,m=Object.fromEntries(l);for(let t=o;t<=i;t++)m[a[t]].active=e.target.checked;const p={...t.tables,...m};s("tables",p),s("lastCheckboxTableId",r)}})),(0,e.createElement)("td",null,(0,e.createElement)("select",{disabled:!n.active,value:n.source,onChange:e=>{const a={...t.tables};a[r].source=e.target.value,"url"===a[r].source&&tp.automatic_periodic_table_import.ABSPATH===a[r].location?a[r].location="https://":"server"===a[r].source&&"https://"===a[r].location&&(a[r].location=tp.automatic_periodic_table_import.ABSPATH),s("tables",a)}},(0,e.createElement)("option",{value:"url"},(0,a.__)("URL","tablepress")),(0,e.createElement)("option",{value:"server"},(0,a.__)("File","tablepress")))),(0,e.createElement)("td",{className:"auto-import-location"},(0,e.createElement)("input",{type:"text",className:"large-text code",disabled:!n.active,value:n.location,onChange:e=>{const a={...t.tables};a[r].location=e.target.value,s("tables",a)}})),(0,e.createElement)("td",{dangerouslySetInnerHTML:{__html:n.last_import}}))))),(0,e.createElement)("tfoot",null,(0,e.createElement)("tr",null,(0,e.createElement)("th",null,(0,a.__)("ID","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Table Name","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Periodic Import","tablepress"),(0,e.createElement)("br",null),(0,e.createElement)("label",{htmlFor:"auto-import-select-all-tfoot"},(0,e.createElement)("input",{type:"checkbox",id:"auto-import-select-all-tfoot",checked:0<l.length&&l.every((([,e])=>e.active)),disabled:0===l.length,onChange:e=>{const a=Object.fromEntries(l.map((([t,a])=>[t,{...a,active:e.target.checked}]))),r={...t.tables,...a};s("tables",r)}})," ",(0,a.__)("Select All"))),(0,e.createElement)("th",null,(0,a.__)("Import Source","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Import File Location","tablepress")),(0,e.createElement)("th",null,(0,a.__)("Last Automatic Import","tablepress"))))),c)}),null))}();